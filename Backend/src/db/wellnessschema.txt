PRAGMA foreign_keys = ON;

-- Users
CREATE TABLE IF NOT EXISTS users (
  user_id     INTEGER PRIMARY KEY AUTOINCREMENT,
  name        TEXT,
  dob         TEXT,
  gender      TEXT,
  height_cm   INTEGER,
  weight_kg   REAL,
  notes       TEXT,
  created_at  TEXT DEFAULT CURRENT_TIMESTAMP,
  updated_at  TEXT
);

-- Messages
CREATE TABLE IF NOT EXISTS messages (
  message_id   INTEGER PRIMARY KEY AUTOINCREMENT,
  sender_id    INTEGER NOT NULL,
  receiver_id  INTEGER NOT NULL,
  content      TEXT NOT NULL,
  created_at   TEXT DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (sender_id) REFERENCES users(user_id) ON DELETE CASCADE,
  FOREIGN KEY (receiver_id) REFERENCES users(user_id) ON DELETE CASCADE
);

-- Message clusters
CREATE TABLE IF NOT EXISTS message_clusters (
  message_id   INTEGER NOT NULL,
  cluster_type TEXT CHECK (cluster_type IN ('physical','biological','cognitive')),
  PRIMARY KEY (message_id, cluster_type),
  FOREIGN KEY (message_id) REFERENCES messages(message_id) ON DELETE CASCADE
);
